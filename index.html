<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Partidas</title>
    
    <style>
        /* --- Configura√ß√£o Base e Fundo Escuro --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #12121e; /* Fundo escuro principal */
            color: #e0e0e0;
            line-height: 1.6;
            overflow-x: hidden; /* Evita que os "blobs" causem scroll horizontal */
            min-height: 100vh;
            padding: 20px;
        }

        /* --- Efeito de "Blobs" de Fundo para o Glassmorphism --- */
        body::before,
        body::after {
            content: '';
            position: fixed;
            z-index: -1;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.2;
        }

        /* Blob 1 */
        body::before {
            background: #9f55ff; /* Roxo */
            width: 350px;
            height: 350px;
            top: -100px;
            left: -100px;
        }

        /* Blob 2 */
        body::after {
            background: #008cff; /* Azul */
            width: 400px;
            height: 400px;
            bottom: -150px;
            right: -150px;
        }

        /* --- Estilo "Liquid Glass" (Glassmorphism) --- */
        .glass-effect {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
        }

        /* --- Container Principal --- */
        .app-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 25px;
        }

        /* --- Abas de Navega√ß√£o (HEADER) --- */
        .tabs {
            display: flex; /* Garante que fiquem lado a lado */
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap; /* --- ADICIONADO: Permite que as abas quebrem em telas menores --- */
        }

        .tab-link {
            flex-grow: 1; /* Faz com que dividam o espa√ßo igualmente */
            flex-basis: 0; /* Necess√°rio para o flex-grow funcionar bem */
            width: auto; 
            min-width: 140px; /* Evita que fiquem muito pequenos antes de quebrar */
            padding: 12px 15px;
            cursor: pointer;
            text-align: center;
            color: #ffffff;
            font-weight: 600;
            transition: all 0.3s ease;
            
            /* Remove estilos de bot√£o padr√£o se necess√°rio */
            border: none;
            background: none; /* Removido para usar o glass-effect */
        }
        
        .tab-link:not(.active) {
             background: rgba(255, 255, 255, 0.08); /* Fundo glass padr√£o */
        }

        .tab-link.active {
            background: rgba(255, 255, 255, 0.25); /* Mais destaque para a aba ativa */
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-link:not(.active):hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* --- Conte√∫do das Abas --- */
        .tab-content-container {
            padding: 25px;
        }

        .tab-content {
            display: none; /* Esconde todas as abas por padr√£o */
        }

        .tab-content.active {
            display: block; /* Mostra apenas a aba ativa */
        }

        /* --- Estiliza√ß√£o de Formul√°rios (Inputs, Bot√µes) --- */
        textarea,
        input[type="number"],
        button,
        select { /* Adicionado select */
            width: 100%; /* Esta regra estava quebrando as abas */
            padding: 12px;
            margin-top: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
            color: #ffffff;
            font-size: 16px;
        }
        
        select option {
            background: #12121e;
        }

        textarea::placeholder {
            color: #aaa;
        }

        button {
            background: #007bff;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 20px;
        }
        
        /* --- Bot√µes de 'Copiar' em verde --- */
        #btn-gerar-lista-times,
        #btn-gerar-lista-partidas,
        #btn-copiar-resultados { 
             background: #28a745; /* Bot√£o verde para 'copiar' */
        }
        #btn-gerar-lista-times:hover,
        #btn-gerar-lista-partidas:hover,
        #btn-copiar-resultados:hover { 
             background: #218838;
        }
        
        /* --- Bot√£o de 'Limpar' em vermelho --- */
        #btn-limpar-resultados {
            background: #dc3545; /* Vermelho 'perigo' */
        }
        #btn-limpar-resultados:hover {
            background: #c82333;
        }

        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }

        /* --- Estiliza√ß√£o Espec√≠fica do Placar --- */
        .scoreboard {
            display: flex;
            justify-content: space-around;
            align-items: center;
            text-align: center;
            margin: 20px 0;
        }

        .score-display {
            font-size: 4rem;
            font-weight: bold;
            margin: 10px 0;
            color: #fff;
        }

        .score-vs {
            font-size: 2rem;
            color: #aaa;
        }

        .btn-score {
            font-size: 2rem;
            width: 60px; /* Este √© mais espec√≠fico, ent√£o sobrescreve o width: 100% */
            height: 60px;
            line-height: 60px;
            border-radius: 50%;
            padding: 0;
        }
        
        #placar-setup {
            margin-bottom: 20px;
        }

        /* --- Estiliza√ß√£o dos Times Gerados (COM CORES NEON) --- */
        #teams-output {
            display: grid;
            /* Esta linha j√° √© responsiva! */
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); 
            gap: 15px;
            margin-bottom: 20px;
        }

        .team-card {
            padding: 15px;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            
            /* --- ESTILOS NEON (agora com cores suaves) --- */
            /* A cor √© injetada via JS na var --team-color */
            border: 2px solid var(--team-color, rgba(255, 255, 255, 0.1));
            box-shadow: 0 0 8px 0px var(--team-color, transparent), 
                        0 0 12px 1px var(--team-color, transparent) inset;
            transition: box-shadow 0.3s ease;
        }
        
        .team-card:hover {
             box-shadow: 0 0 15px 2px var(--team-color, transparent), 
                        0 0 12px 1px var(--team-color, transparent) inset;
        }

        .team-card h3 {
            /* A cor √© injetada via JS */
            color: var(--team-color, #00aaff); 
            border-bottom: 1px solid var(--team-color, #00aaff);
            padding-bottom: 5px;
            margin-bottom: 10px;
        }

        .team-card ul {
            list-style: none;
            padding-left: 0;
            margin-top: 10px;
        }
        
        .team-card li {
            padding: 2px 0;
        }
        
        /* --- ESTILO PARA AS NOTAS DE REVEZAMENTO --- */
        .team-card-note {
            font-size: 0.85em;
            color: #ffab00; /* Laranja/Amarelo para destaque */
            background: rgba(255, 171, 0, 0.1);
            padding: 8px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .team-card-note-loan {
             /* Cor do H3 (vari√°vel) para a nota de emprestar */
             color: var(--team-color, #00aaff); 
             background: rgba(0, 170, 255, 0.1);
        }
        
        #rotation-output h3 {
            color: #ffab00;
            margin-top: 20px;
            border-bottom: 1px solid #ffab00;
            padding-bottom: 5px;
        }
        #rotation-output p {
            margin-bottom: 10px;
        }
        
        /* --- Textarea para Copiar Times --- */
        #teams-list-output,
        #partidas-list-output { 
            display: none; /* Come√ßa escondido */
            margin-top: 15px;
            height: 200px;
            background: rgba(0,0,0,0.3);
            color: #fff;
        }
        
        /* --- Aba de Partidas --- */
        #match-list-description {
            padding: 15px;
            background: rgba(0, 100, 200, 0.1);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        #match-list li {
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
            margin-bottom: 5px;
        }
        
        /* Div para o bot√£o/textarea de copiar partidas */
        #partidas-list-copy {
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }


        /* Aplicando o efeito Glass nos elementos principais */
        .app-container,
        .tab-link,
        .tab-content-container {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
        }
        
        
        /* ------------------------------------------
        --- REGRAS DE RESPONSIVIDADE ---
        ------------------------------------------
        */
        
        /* Tablets e Telas Menores (abaixo de 768px) */
        @media (max-width: 768px) {
            body {
                padding: 10px; /* Reduz padding do corpo */
            }
            
            .app-container {
                margin: 10px auto;
                padding: 15px; /* Reduz padding do container */
            }

            .tab-content-container {
                padding: 15px;
            }
        }

        /* Celulares (abaixo de 480px) */
        @media (max-width: 480px) {
            body {
                padding: 0; /* Remove padding do body, deixa o app-container tomar conta */
                font-size: 14px; /* Reduz fonte base */
            }

            .app-container {
                margin: 0;
                padding: 10px;
                border-radius: 0; /* Tela cheia no celular */
                border: none;
                box-shadow: none; /* Remove sombra no celular */
            }
            
            .glass-effect {
                /* Desliga o efeito glass no celular, pode ser pesado e desnecess√°rio */
                background: rgba(255, 255, 255, 0.05);
                backdrop-filter: none;
                -webkit-backdrop-filter: none;
            }
            
            /* T√≠tulos */
            h2 {
                font-size: 1.3rem;
                margin-bottom: 15px;
            }
            h3 {
                font-size: 1.1rem;
            }

            /* Abas */
            .tabs {
                gap: 5px; /* Menos espa√ßo entre abas */
            }
            .tab-link {
                font-size: 0.85rem;
                padding: 10px 5px;
                min-width: 100px; /* Menor */
            }

            /* Placar */
            .scoreboard {
                flex-wrap: wrap; /* Permite quebrar se necess√°rio */
                gap: 10px;
            }
            .score-display {
                font-size: 2.5rem; /* Reduz drasticamente o placar */
            }
            .score-vs {
                font-size: 1.5rem;
            }
            .btn-score {
                width: 50px;
                height: 50px;
                line-height: 50px;
                font-size: 1.5rem;
            }
            
            /* Textareas de "Copiar" */
            #teams-list-output,
            #partidas-list-output {
                height: 150px;
            }
        }
        
    </style>
</head>
<body>

    <div class="app-container">
        <nav class="tabs">
            <button class="tab-link active" data-tab="tab-config">‚öôÔ∏è Configura√ß√£o</button>
            <button class="tab-link" data-tab="tab-times">üë• Times</button>
            <button class="tab-link" data-tab="tab-partidas">‚öîÔ∏è Partidas</button>
            <button class="tab-link" data-tab="tab-placar">üî¢ Placar</button>
            <button class="tab-link" data-tab="tab-resultados">üìã Resultados</button>
        </nav>

        <main class="tab-content-container">

            <section id="tab-config" class="tab-content active">
                <h2>‚öôÔ∏è Configura√ß√£o da Rodada</h2>
                <p>Insira o nome de todos os jogadores, um por linha.</p>
                <textarea id="player-input" rows="10" placeholder="Ex:&#10;Gabriel&#10;Ana&#10;Bruno&#10;Carla&#10;..."></textarea>
                
                <label for="num-times">N√∫mero m√≠nimo de times (m√≠n. 3):</label>
                <input type="number" id="num-times" value="3" min="3">
                
                <button id="btn-sortear">Sortear Times</button>
            </section>

            <section id="tab-times" class="tab-content">
                <h2>üë• Times Sorteados</h2>
                <div id="teams-output">
                    </div>
                
                <button id="btn-gerar-lista-times">Gerar Lista para Copiar</button>
                <textarea id="teams-list-output" readonly placeholder="A lista dos times para copiar aparecer√° aqui..."></textarea>
                
                <div id="rotation-output">
                    </div>
            </section>

            <section id="tab-partidas" class="tab-content">
                <h2>‚öîÔ∏è Controle de Partidas</h2>
                
                <div id="match-list-description">
                    <p>Abaixo est√° a lista de todos os jogos poss√≠veis ("todos contra todos").</p>
                    <p><strong>Como funciona a regra da pausa:</strong></O>
                    <p>Ao usar a aba "Placar", voc√™ (o operador) deve seguir a regra: um time que jogar <strong>2 partidas seguidas</strong> deve <strong>descansar na pr√≥xima</strong> rodada de jogos.</p>
                    <p>O sistema apenas lista as partidas. O controle de quem joga e quem pausa √© feito por voc√™ ao selecionar a partida na aba "Placar".</p>
                </div>
                
                <ul id="match-list">
                    </ul>
                
                <div id="partidas-list-copy">
                    <button id="btn-gerar-lista-partidas">üìã Gerar Lista de Partidas para Copiar</button>
                    <textarea id="partidas-list-output" readonly placeholder="A lista de partidas para copiar aparecer√° aqui..."></textarea>
                </div>
            </section>

            <section id="tab-placar" class="tab-content">
                <h2>üî¢ Placar da Partida</h2>
                
                <div id="placar-setup">
                    <label for="match-selector">Selecione a Partida:</label>
                    <select id="match-selector">
                        <option value="">-- Primeiro gere as partidas --</option>
                    </select>
                    <button id="btn-iniciar-partida">Iniciar Partida Selecionada</button>
                </div>
                
                <div class="scoreboard">
                    <div class="score-team">
                        <h3 id="placar-time-a">Time A</h3>
                        <div class="score-display" id="score-a">0</div>
                        <button class="btn-score" data-team="a" disabled>+</button>
                    </div>
                    <div class="score-vs">VS</div>
                    <div class="score-team">
                        <h3 id="placar-time-b">Time B</h3>
                        <div class="score-display" id="score-b">0</div>
                        <button class="btn-score" data-team="b" disabled>+</button>
                    </div>
                </div>
                <button id="btn-reset-placar">Resetar Placar</button>
                <button id="btn-finalizar-partida" disabled>Finalizar Partida (25pts)</button>
            </section>

            <section id="tab-resultados" class="tab-content">
                <h2>üìã Resultados Salvos</h2>
                <p>Resultados das partidas finalizadas, prontos para copiar:</p>
                <textarea id="results-output" rows="15" readonly></textarea>
                
                <button id="btn-copiar-resultados">üìã Copiar Resultados Salvos</button>
                <button id="btn-baixar-resumo">üíæ Baixar Resumo do Dia (PDF)</button>
                
                <button id="btn-limpar-resultados">‚ùå Limpar Hist√≥rico Salvo</button>
            </section>

        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- L√ìGICA DE NAVEGA√á√ÉO POR ABAS ---

            const tabLinks = document.querySelectorAll('.tab-link');
            const tabContents = document.querySelectorAll('.tab-content');

            tabLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const tabId = link.getAttribute('data-tab');
                    // Remove 'active' de todos
                    tabLinks.forEach(item => item.classList.remove('active'));
                    tabContents.forEach(item => item.classList.remove('active'));
                    // Adiciona 'active' ao clicado
                    link.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });

            // --- FIM DA L√ìGICA DE ABAS ---


            // --- IN√çCIO DA L√ìGICA DO JOGO ---

            // Elementos da UI
            const btnSortear = document.getElementById('btn-sortear');
            const playerInput = document.getElementById('player-input');
            const teamsOutput = document.getElementById('teams-output');
            const rotationOutput = document.getElementById('rotation-output');
            
            const matchList = document.getElementById('match-list');
            const matchListDesc = document.getElementById('match-list-description');
            
            const matchSelector = document.getElementById('match-selector');
            const btnIniciarPartida = document.getElementById('btn-iniciar-partida');
            
            const resultsOutput = document.getElementById('results-output');
            
            const btnGerarListaTimes = document.getElementById('btn-gerar-lista-times');
            const teamsListOutput = document.getElementById('teams-list-output');
            
            const btnGerarListaPartidas = document.getElementById('btn-gerar-lista-partidas');
            const partidasListOutput = document.getElementById('partidas-list-output');
            
            const btnCopiarResultados = document.getElementById('btn-copiar-resultados');
            
            const btnLimparResultados = document.getElementById('btn-limpar-resultados');
            
            // Elemento para Baixar Resumo
            const btnBaixarResumo = document.getElementById('btn-baixar-resumo');


            // --- Lista de Cores para Times (Tons mais suaves) ---
            const teamColors = [
                { name: "Laranja", hex: "#FF8A65" }, // Laranja Suave
                { name: "Verde", hex: "#66BB6A" },   // Verde Suave
                { name: "Azul", hex: "#42A5F5" },     // Azul Suave
                { name: "Rosa", hex: "#F06292" },      // Rosa Suave
                { name: "Ciano", hex: "#26C6DA" },    // Ciano Suave
                { name: "Amarelo", hex: "#FFEE58" },  // Amarelo Suave
                { name: "Violeta", hex: "#AB47BC" }  // Violeta Suave
            ];

            // Vari√°veis globais para guardar o estado
            let todosJogadores = [];
            // O objeto 'times' agora tamb√©m armazena as cores
            let times = []; // { nome, jogadores, tipo, colorName, colorHex }
            let partidas = []; 
            let resultadosFinais = []; // Agora √© carregado do LocalStorage

            
            // --- L√ìGICA DE PERSIST√äNCIA (LOCALSTORAGE) ---
            
            const STORAGE_KEY = 'gerenciadorPartidasResultados';

            // 1. Fun√ß√£o para Carregar os dados salvos
            function loadResultsFromLocalStorage() {
                const dadosSalvos = localStorage.getItem(STORAGE_KEY);
                if (dadosSalvos) {
                    resultadosFinais = JSON.parse(dadosSalvos);
                    resultsOutput.value = resultadosFinais.join('\n');
                }
            }
            
            // 2. Fun√ß√£o para Salvar os dados
            function saveResultsToLocalStorage() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(resultadosFinais));
            }

            // 3. Fun√ß√£o para Limpar os dados
            btnLimparResultados.addEventListener('click', () => {
                if (confirm('Tem certeza que deseja apagar permanentemente todo o hist√≥rico de resultados salvos?')) {
                    resultadosFinais = [];
                    resultsOutput.value = '';
                    localStorage.removeItem(STORAGE_KEY);
                    alert('Hist√≥rico de resultados limpo.');
                }
            });

            // 4. Carrega os dados assim que a p√°gina √© aberta
            loadResultsFromLocalStorage();
            
            // --- FIM DA L√ìGICA DE PERSIST√äNCIA ---


            // --- 1. Sorteio de Jogadores ---
            btnSortear.addEventListener('click', () => {
                const nomes = playerInput.value.split('\n')
                                            .map(nome => nome.trim()) // Limpa espa√ßos
                                            .filter(nome => nome.length > 0); // Remove linhas em branco
                
                const minJogadores = 13; // 6 + 6 + 1
                
                if (nomes.length < minJogadores) {
                    alert(`S√£o necess√°rios pelo menos ${minJogadores} jogadores para formar 2 times completos e 1 time reserva/revezamento.`);
                    return;
                }
                
                let jogadoresEmbaralhados = shuffleArray(nomes);
                
                // Limpa sa√≠das anteriores
                teamsOutput.innerHTML = '';
                rotationOutput.innerHTML = '';
                teamsListOutput.style.display = 'none'; // Esconde o campo de copiar
                partidasListOutput.style.display = 'none'; // Esconde o campo de copiar partidas
                times = [];
                let teamCounter = 1;

                // --- L√ìGICA DE SORTEIO IMPLEMENTADA ---
                
                // Fun√ß√£o interna para adicionar time com cor
                function adicionarTime(jogadores, tipo) {
                    const colorObj = teamColors[times.length % teamColors.length];
                    times.push({
                        nome: `Time ${teamCounter++}`,
                        jogadores: jogadores,
                        tipo: tipo,
                        colorName: colorObj.name,
                        colorHex: colorObj.hex
                    });
                }
                
                // 1. Criar Time 1 (6 jogadores)
                adicionarTime(jogadoresEmbaralhados.splice(0, 6), "completo");

                // 2. Criar Time 2 (6 jogadores)
                adicionarTime(jogadoresEmbaralhados.splice(0, 6), "completo");

                // 3. Criar times subsequentes
                while (jogadoresEmbaralhados.length > 0) {
                    const remaining = jogadoresEmbaralhados.length;
                    let tipoTime = "";
                    let jogadoresDoTime;

                    if (remaining >= 6) {
                        tipoTime = "completo";
                        jogadoresDoTime = jogadoresEmbaralhados.splice(0, 6);
                    } else if (remaining >= 3) {
                        tipoTime = "revezamento";
                        jogadoresDoTime = jogadoresEmbaralhados.splice(0, remaining);
                    } else {
                        tipoTime = "reserva";
                        jogadoresDoTime = jogadoresEmbaralhados.splice(0, remaining);
                    }
                    adicionarTime(jogadoresDoTime, tipoTime);
                }
                
                exibirTimes();
                gerarPartidas(); // Chama a fun√ß√£o que gera a lista de partidas
                
                // Ap√≥s a l√≥gica, mude para a aba de times
                mudarDeAba('tab-times');
            });

            // *** FUN√á√ÉO ATUALIZADA (com Cores e Notas) ***
            function exibirTimes() {
                teamsOutput.innerHTML = '';
                rotationOutput.innerHTML = '';
                
                let hasRotation = false;
                let hasReserves = false;
                let reservePlayers = [];

                times.forEach(time => {
                    const card = document.createElement('div');
                    card.className = 'team-card';
                    // --- Injeta a cor neon via CSS Variable ---
                    card.style.setProperty('--team-color', time.colorHex);
                    
                    let tipoTimeLabel = "";
                    let cardNote = "";

                    switch(time.tipo) {
                        case 'completo':
                            tipoTimeLabel = "(Completo)";
                            cardNote = `<div class="team-card-note team-card-note-loan" style="background-color: ${time.colorHex}1A;"><b>Empresta jogadores</b> para times de revezamento quando estiver de pausa.</div>`;
                            break;
                        case 'revezamento':
                            tipoTimeLabel = "(Revezamento)";
                            const needs = 6 - time.jogadores.length;
                            cardNote = `<div class="team-card-note"><b>Recebe ${needs} jogador(es)</b> do time que est√° de pausa.</div>`;
                            hasRotation = true;
                            break;
                        case 'reserva':
                            tipoTimeLabel = "(Reserva)";
                            cardNote = `<div class="team-card-note"><b>N√£o joga.</b> Fica na espera.</div>`;
                            hasReserves = true;
                            reservePlayers.push(...time.jogadores);
                            break;
                    }
                    
                    let listaJogadoresHTML = time.jogadores.map(j => `<li>${j}</li>`).join('');
                    
                    card.innerHTML = `
                        <h3>${time.nome} (${time.colorName}) <span style="font-weight: 400; font-size: 0.9em;">${tipoTimeLabel}</span></h3>
                        <ul>${listaJogadoresHTML}</ul>
                        ${cardNote}
                    `;
                    teamsOutput.appendChild(card);
                });
                
                // Explica as regras de revezamento/reserva no final da tela
                rotationOutput.innerHTML = `<h3>Regras de Revezamento e Reserva</h3>`;
                
                if (hasRotation) {
                    rotationOutput.innerHTML += `
                        <p><b>REVEZAMENTO:</b> Os times de "Revezamento" (3-5 jogadores) ser√£o completados em seus jogos.</p>
                        <p>Para cada jogo de um time de revezamento, o time que est√° 'descansando' (que n√£o est√° jogando) dever√° 'emprestar' o n√∫mero de jogadores necess√°rios para completar 6.</p>
                    `;
                }
                
                if (hasReserves) {
                     rotationOutput.innerHTML += `
                        <p><b>RESERVA:</b> Os times "Reserva" (1-2 jogadores) n√£o participam das partidas. Os seguintes jogadores est√£o na reserva:</p>
                        <p><i>${reservePlayers.join(', ')}</i></p>
                    `;
                }
            }
            
            // --- Fun√ß√£o para o Bot√£o "Gerar Lista para Copiar" (TIMES) ---
            btnGerarListaTimes.addEventListener('click', () => {
                if (times.length === 0) {
                    alert('Primeiro sorteie os times antes de gerar a lista.');
                    return;
                }
                
                let outputText = "";
                
                times.forEach(time => {
                    outputText += `--- ${time.nome} (${time.colorName}) ---\n`;
                    outputText += time.jogadores.join('\n');
                    outputText += `\n\n`; // Adiciona duas quebras de linha para separar
                });
                
                teamsListOutput.value = outputText;
                teamsListOutput.style.display = 'block'; // Mostra o campo
                
                // Tenta copiar automaticamente
                copyTextToClipboard(outputText, teamsListOutput);
            });


            // --- 2. Controle de Partidas (ATUALIZADO com Cores) ---
            function gerarPartidas() {
                partidas = [];
                matchList.innerHTML = '';
                matchSelector.innerHTML = '<option value="">-- Selecione uma partida --</option>';
                partidasListOutput.style.display = 'none'; // Esconde o campo de copiar

                // Filtra times que jogam (objetos completos)
                const timesAtivos = times.filter(time => time.tipo !== 'reserva');

                if (timesAtivos.length < 2) {
                    matchList.innerHTML = '<li>Times insuficientes para gerar partidas.</li>';
                    return;
                }

                // Gera a lista "todos contra todos"
                for (let i = 0; i < timesAtivos.length; i++) {
                    for (let j = i + 1; j < timesAtivos.length; j++) {
                        const timeA = timesAtivos[i];
                        const timeB = timesAtivos[j];
                        
                        // Salva os nomes simples no array 'partidas'
                        partidas.push([timeA.nome, timeB.nome]); 
                        
                        const partidaTexto = `${timeA.nome} (${timeA.colorName}) vs ${timeB.nome} (${timeB.colorName})`;
                        
                        // Adiciona na Aba 3 (Lista de Partidas)
                        const li = document.createElement('li');
                        li.textContent = partidaTexto;
                        matchList.appendChild(li);
                        
                        // Adiciona na Aba 4 (Seletor do Placar)
                        const option = document.createElement('option');
                        option.value = `${timeA.nome}|${timeB.nome}`; // O valor ainda √© simples
                        option.textContent = partidaTexto; // O texto vis√≠vel tem as cores
                        matchSelector.appendChild(option);
                    }
                }
            }
            
            // --- Fun√ß√£o para o Bot√£o "Gerar Lista para Copiar" (PARTIDAS) ---
            btnGerarListaPartidas.addEventListener('click', () => {
                if (partidas.length === 0) {
                    alert('Primeiro sorteie os times e gere as partidas.');
                    return;
                }
                
                let outputText = "--- ORDEM DAS PARTIDAS (Todos contra Todos) ---\n\n";
                
                partidas.forEach((partida, index) => {
                    const timeAName = partida[0];
                    const timeBName = partida[1];
                    
                    const timeA = times.find(t => t.nome === timeAName);
                    const timeB = times.find(t => t.nome === timeBName);
                    
                    if(timeA && timeB) {
                         outputText += `Jogo ${index + 1}: ${timeA.nome} (${timeA.colorName}) vs ${timeB.nome} (${timeB.colorName})\n`;
                    }
                });
                
                partidasListOutput.value = outputText;
                partidasListOutput.style.display = 'block'; // Mostra o campo
                
                // Tenta copiar automaticamente
                copyTextToClipboard(outputText, partidasListOutput);
            });


            // --- 3. Contador de Pontos ---
            let placarA = 0;
            let placarB = 0;
            const scoreADisplay = document.getElementById('score-a');
            const scoreBDisplay = document.getElementById('score-b');
            const placarTimeA = document.getElementById('placar-time-a');
            const placarTimeB = document.getElementById('placar-time-b');
            const btnsScore = document.querySelectorAll('.btn-score');
            const btnFinalizar = document.getElementById('btn-finalizar-partida');
            
            // Bot√£o "Iniciar Partida"
            btnIniciarPartida.addEventListener('click', () => {
                const selectedMatch = matchSelector.value;
                if (!selectedMatch) {
                    alert('Por favor, selecione uma partida para iniciar.');
                    return;
                }
                
                const [timeAName, timeBName] = selectedMatch.split('|');
                
                // Busca o objeto do time para pegar a cor
                const timeA = times.find(t => t.nome === timeAName);
                const timeB = times.find(t => t.nome === timeBName);
                
                // Atualiza o placar com NOME e COR
                placarTimeA.textContent = `${timeA.nome} (${timeA.colorName})`;
                placarTimeA.style.color = timeA.colorHex;
                
                placarTimeB.textContent = `${timeB.nome} (${timeB.colorName})`;
                placarTimeB.style.color = timeB.colorHex;
                
                resetarPlacar();
                
                // Habilita os bot√µes de pontua√ß√£o e finaliza√ß√£o
                btnsScore.forEach(btn => btn.disabled = false);
                btnFinalizar.disabled = false;
            });

            // Bot√µes de pontua√ß√£o
            btnsScore.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const time = e.target.getAttribute('data-team');
                    if (time === 'a') {
                        placarA++;
                        scoreADisplay.textContent = placarA;
                    } else {
                        placarB++;
                        scoreBDisplay.textContent = placarB;
                    }
                    verificarFimDeJogo();
                });
            });

            document.getElementById('btn-reset-placar').addEventListener('click', resetarPlacar);
            btnFinalizar.addEventListener('click', salvarPartida);

            function verificarFimDeJogo() {
                if (placarA >= 25 || placarB >= 25) {
                    alert('Partida finalizada! Clique em "Finalizar Partida" para salvar.');
                    btnsScore.forEach(btn => btn.disabled = true); // Desabilita pontos
                }
            }
            
            function salvarPartida() {
                const timeA = placarTimeA.textContent; // J√° inclui cor
                const timeB = placarTimeB.textContent; // J√° inclui cor
                
                if (placarA === 0 && placarB === 0) {
                    alert('O placar est√° 0 a 0.');
                    return;
                }
                
                const resultadoTexto = `Partida: ${timeA} vs ${timeB} | Placar: ${placarA} - ${placarB}`;
                
                // Adiciona ao log de resultados
                resultadosFinais.push(resultadoTexto);
                resultsOutput.value = resultadosFinais.join('\n');
                
                // --- Salva no LocalStorage ---
                saveResultsToLocalStorage();
                
                alert('Resultado salvo!');
                
                // Remove a partida do seletor para n√£o ser jogada novamente
                // O valor do 'option' n√£o tem cores, ent√£o buscamos por ele
                const timeAName = timeA.split(' (')[0]; // "Time 1"
                const timeBName = timeB.split(' (')[0]; // "Time 2"
                
                const optionToRemove = matchSelector.querySelector(`option[value="${timeAName}|${timeBName}"]`);
                if(optionToRemove) {
                    optionToRemove.remove();
                }
                
                // Reseta o placar e desabilita bot√µes
                resetarPlacar();
                placarTimeA.textContent = "Time A";
                placarTimeB.textContent = "Time B";
                placarTimeA.style.color = "#e0e0e0"; // Reseta cor
                placarTimeB.style.color = "#e0e0e0"; // Reseta cor
                
                btnsScore.forEach(btn => btn.disabled = true);
                btnFinalizar.disabled = true;
                matchSelector.value = "";
            }

            function resetarPlacar() {
                placarA = 0;
                placarB = 0;
                scoreADisplay.textContent = 0;
                scoreBDisplay.textContent = 0;
                // Reabilita bot√µes caso o placar tenha sido apenas resetado, n√£o finalizado
                if(placarTimeA.textContent !== "Time A") {
                     btnsScore.forEach(btn => btn.disabled = false);
                }
            }
            
            // --- Fun√ß√£o para o Bot√£o "Copiar Resultados Salvos" ---
            btnCopiarResultados.addEventListener('click', () => {
                const textToCopy = resultsOutput.value;
                if (textToCopy.trim() === "") {
                    alert('N√£o h√° resultados para copiar.');
                    return;
                }
                
                // Tenta copiar automaticamente
                copyTextToClipboard(textToCopy, resultsOutput);
            });
            
            // --- ATUALIZADO: Fun√ß√£o para o Bot√£o "Baixar Resumo do Dia" (PDF) ---
            btnBaixarResumo.addEventListener('click', () => {
                
                // 0. Verifica se a biblioteca jsPDF foi carregada
                if (typeof window.jspdf === 'undefined') {
                    alert('Erro: A biblioteca de PDF (jsPDF) n√£o foi carregada. Verifique sua conex√£o com a internet e tente novamente.');
                    return;
                }
                
                // 1. Verifica se h√° dados
                if (times.length === 0 && resultadosFinais.length === 0) {
                    alert('N√£o h√° dados para baixar! Sorteie os times ou jogue uma partida primeiro.');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Posi√ß√£o Y (vertical) inicial, com margem de 15mm do topo
                let y = 15;
                const margin = 10;
                const pageHeight = doc.internal.pageSize.height;

                // Fun√ß√£o interna para checar e adicionar nova p√°gina
                function checkPageBreak(yNeeded = 10) {
                    if (y + yNeeded > pageHeight - margin) {
                        doc.addPage();
                        y = 15; // Reseta a posi√ß√£o Y para a nova p√°gina
                    }
                }

                // --- Monta o conte√∫do do PDF ---
                
                const today = new Date();
                const dateString = today.toLocaleDateString('pt-BR');
                const timeString = today.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0'); // Meses s√£o 0-based
                const dd = String(today.getDate()).padStart(2, '0');
                const filename = `Resumo_Jogo_${yyyy}-${mm}-${dd}.pdf`;

                // T√≠tulo
                doc.setFontSize(22);
                doc.text("Resumo do Jogo", margin, y);
                y += 10;
                doc.setFontSize(10);
                doc.setTextColor(100); // Cinza
                doc.text(`Gerado em: ${dateString} √†s ${timeString}`, margin, y);
                y += 15; // Espa√ßo maior
                
                doc.setTextColor(0); // Preto

                // --- Se√ß√£o 1: Times Sorteados ---
                checkPageBreak(15);
                doc.setFontSize(18);
                doc.text("Times Sorteados", margin, y);
                y += 8;
                
                if (times.length > 0) {
                    times.forEach(time => {
                        checkPageBreak(15); // Espa√ßo para t√≠tulo e jogadores
                        
                        // T√≠tulo do Time (com cor)
                        doc.setFontSize(14);
                        doc.setTextColor(time.colorHex); // Aplica a cor do time!
                        doc.text(`${time.nome} (${time.colorName}) [${time.tipo}]`, margin + 5, y);
                        
                        // Lista de Jogadores (preto)
                        doc.setTextColor(0); // Reseta para preto
                        doc.setFontSize(10);
                        y += 6;
                        // doc.text(time.jogadores.join(', '), margin + 5, y);
                        // Quebra a lista de jogadores em linhas se for muito longa
                        let playerLines = doc.splitTextToSize(time.jogadores.join(', '), 180);
                        doc.text(playerLines, margin + 5, y);
                        y += (playerLines.length * 5) + 5; // Adiciona espa√ßo extra

                    });
                } else {
                    doc.setFontSize(10);
                    doc.text("Nenhum time foi sorteado.", margin + 5, y);
                    y += 10;
                }

                // --- Se√ß√£o 2: Ordem das Partidas ---
                checkPageBreak(15);
                y += 5; // Espa√ßo antes da se√ß√£o
                doc.setFontSize(18);
                doc.text("Ordem das Partidas (Todos vs Todos)", margin, y);
                y += 8;
                doc.setFontSize(10);
                
                if (partidas.length > 0) {
                    partidas.forEach((partida, index) => {
                        checkPageBreak(8); // Espa√ßo para uma linha
                        
                        const timeAName = partida[0];
                        const timeBName = partida[1];
                        const timeA = times.find(t => t.nome === timeAName);
                        const timeB = times.find(t => t.nome === timeBName);
                        
                        let partidaTexto = `Jogo ${index + 1}: ${timeAName} vs ${timeBName}`;
                        if(timeA && timeB) {
                             partidaTexto = `Jogo ${index + 1}: ${timeA.nome} (${timeA.colorName}) vs ${timeB.nome} (${timeB.colorName})`;
                        }
                        
                        doc.text(partidaTexto, margin + 5, y);
                        y += 6;
                    });
                } else {
                    doc.text("Nenhuma partida foi gerada.", margin + 5, y);
                    y += 10;
                }
                
                // --- Se√ß√£o 3: Resultados Salvos ---
                checkPageBreak(15);
                y += 5; // Espa√ßo antes da se√ß√£o
                doc.setFontSize(18);
                doc.text("Resultados Salvos", margin, y);
                y += 8;
                doc.setFontSize(10);
                
                if (resultadosFinais.length > 0) {
                     resultadosFinais.forEach(resultado => {
                        checkPageBreak(8);
                        doc.text(resultado, margin + 5, y);
                        y += 6;
                     });
                } else {
                    doc.text("Nenhum resultado foi salvo.", margin + 5, y);
                }

                // 4. Salva o arquivo
                doc.save(filename);
            });


            // --- Fun√ß√µes Utilit√°rias ---
            
            // --- Fun√ß√£o de C√≥pia Autom√°tica ---
            async function copyTextToClipboard(text, elementToSelect) {
                // Tenta usar a API moderna (navigator.clipboard)
                // Isso funciona em HTTPS ou localhost
                if (navigator.clipboard && window.isSecureContext) {
                    try {
                        await navigator.clipboard.writeText(text);
                        alert('Texto copiado para a √°rea de transfer√™ncia!');
                    } catch (err) {
                        // A permiss√£o pode ter sido negada
                        console.error('Falha ao copiar com navigator: ', err);
                        elementToSelect.select(); // Fallback
                        alert('Falha ao copiar. O texto foi selecionado. Copie manualmente.');
                    }
                } else {
                    // Fallback para contextos n√£o seguros (como file://) ou navegadores antigos
                    console.warn('API de Clipboard n√£o dispon√≠vel. Usando fallback de sele√ß√£o.');
                    elementToSelect.select();
                    alert('Falha ao copiar automaticamente (ambiente n√£o seguro)! O texto foi selecionado. Pressione Ctrl+C (ou copie manualmente).');
                }
            }

            
            function shuffleArray(array) {
                let newArray = [...array]; // Copia o array
                let currentIndex = newArray.length, randomIndex;
                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [newArray[currentIndex], newArray[randomIndex]] = [
                        newArray[randomIndex], newArray[currentIndex]];
                }
                return newArray;
            }

            function mudarDeAba(tabId) {
                tabLinks.forEach(item => item.classList.remove('active'));
                tabContents.forEach(item => item.classList.remove('active'));

                const linkAtivo = document.querySelector(`[data-tab="${tabId}"]`);
                const conteudoAtivo = document.getElementById(tabId);
                
                if (linkAtivo) linkAtivo.classList.add('active');
                if (conteudoAtivo) conteudoAtivo.classList.add('active');
            }

        });
    </script>
</body>
</html>
