<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Partidas</title>
    
    <style>
        /* --- Configura√ß√£o Base e Fundo Escuro --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #12121e; /* Fundo escuro principal */
            color: #e0e0e0;
            line-height: 1.6;
            overflow-x: hidden; /* Evita que os "blobs" causem scroll horizontal */
            min-height: 100vh;
            padding: 20px;
        }

        /* --- Efeito de "Blobs" de Fundo --- */
        body::before,
        body::after {
            content: '';
            position: fixed;
            z-index: -1;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.2;
        }
        body::before { background: #9f55ff; width: 350px; height: 350px; top: -100px; left: -100px; }
        body::after { background: #008cff; width: 400px; height: 400px; bottom: -150px; right: -150px; }

        /* --- Estilo "Liquid Glass" --- */
        .glass-effect {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
        }

        /* --- Layout Principal --- */
        .app-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 25px;
        }

        /* --- Abas de Navega√ß√£o --- */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-link {
            flex-grow: 1;
            flex-basis: 0;
            min-width: 120px;
            padding: 12px 15px;
            cursor: pointer;
            text-align: center;
            color: #ffffff;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px; /* Arredondado nas abas tamb√©m */
        }
        .tab-link.active {
            background: rgba(255, 255, 255, 0.25);
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* --- Conte√∫do das Abas --- */
        .tab-content-container {
            padding: 25px;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* --- Formul√°rios --- */
        textarea, input[type="number"], button, select {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
            color: #ffffff;
            font-size: 16px;
        }
        select option { background: #12121e; }
        textarea::placeholder { color: #aaa; }

        /* --- Bot√µes de A√ß√£o --- */
        button {
            background: #007bff;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 20px;
            border: none;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #555; cursor: not-allowed; }

        /* Cores espec√≠ficas de bot√µes */
        .btn-green { background: #28a745; }
        .btn-green:hover { background: #218838; }
        .btn-red { background: #dc3545; }
        .btn-red:hover { background: #c82333; }

        /* --- Layout de Configura√ß√£o (G√™neros lado a lado) --- */
        .gender-input-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .gender-block {
            flex: 1;
        }
        .gender-block h3 {
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        #men-input { border-color: rgba(0, 170, 255, 0.3); }
        #women-input { border-color: rgba(255, 105, 180, 0.3); }


        /* --- Placar --- */
        .scoreboard {
            display: flex;
            justify-content: space-around;
            align-items: center;
            text-align: center;
            margin: 20px 0;
        }
        .score-display {
            font-size: 4rem;
            font-weight: bold;
            margin: 10px 0;
            color: #fff;
        }
        .score-vs { font-size: 2rem; color: #aaa; }
        .btn-score {
            font-size: 2rem;
            width: 60px; height: 60px;
            line-height: 60px;
            border-radius: 50%;
            padding: 0;
        }

        /* --- Times (Cards Neon) --- */
        #teams-output {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .team-card {
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            border: 2px solid var(--team-color, rgba(255,255,255,0.1));
            box-shadow: 0 0 8px 0px var(--team-color, transparent), 
                        0 0 20px 1px var(--team-color, transparent) inset;
            transition: all 0.3s ease;
        }
        .team-card:hover {
             box-shadow: 0 0 15px 2px var(--team-color, transparent), 
                        0 0 30px 5px var(--team-color, transparent) inset;
        }
        .team-card h3 {
            color: var(--team-color, #00aaff);
            border-bottom: 1px solid var(--team-color, rgba(255,255,255,0.1));
            padding-bottom: 8px;
            margin-bottom: 10px;
        }
        .team-card ul { list-style: none; padding-left: 0; }
        .team-card li {
            padding: 4px 8px;
            margin-bottom: 4px;
            border-radius: 4px;
            background: rgba(255,255,255,0.03);
            display: flex;
            justify-content: space-between;
        }
        .gender-tag {
            font-size: 0.8em;
            opacity: 0.7;
            font-weight: bold;
        }
        .tag-m { color: #42A5F5; } /* Azul claro para M */
        .tag-f { color: #F48FB1; } /* Rosa claro para F */

        .team-card-note {
            font-size: 0.85em;
            color: #ffab00;
            background: rgba(255, 171, 0, 0.15);
            padding: 8px;
            border-radius: 6px;
            margin-top: 12px;
        }

        /* --- √Åreas de Texto de C√≥pia (escondidas por padr√£o) --- */
        .copy-textarea {
            display: none;
            margin-top: 15px;
            height: 150px;
            font-family: monospace;
            font-size: 0.9em;
        }

        /* --- Listas e Descri√ß√µes --- */
        #match-list li {
            padding: 10px;
            background: rgba(0,0,0,0.25);
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid rgba(255,255,255,0.1);
        }
        #rotation-output h3 { color: #ffab00; margin-top: 30px; border-bottom: 1px solid #ffab00; }


        /* --- Responsividade --- */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .app-container { margin: 10px auto; padding: 15px; }
            .gender-input-container { flex-direction: column; gap: 10px; }
        }
        @media (max-width: 480px) {
            body { padding: 0; }
            .app-container { margin: 0; border-radius: 0; border: none; }
            .glass-effect { background: #1a1a2e; backdrop-filter: none; } /* Fallback s√≥lido para mobile */
            .score-display { font-size: 3rem; }
            .btn-score { width: 50px; height: 50px; line-height: 50px; font-size: 1.5rem; }
        }
    </style>
</head>
<body>

    <div class="app-container glass-effect">
        <nav class="tabs">
            <button class="tab-link active" data-tab="tab-config">‚öôÔ∏è In√≠cio</button>
            <button class="tab-link" data-tab="tab-times">üë• Times</button>
            <button class="tab-link" data-tab="tab-partidas">‚öîÔ∏è Partidas</button>
            <button class="tab-link" data-tab="tab-placar">üî¢ Placar</button>
            <button class="tab-link" data-tab="tab-resultados">üìã Resultados</button>
        </nav>

        <main class="tab-content-container glass-effect">

            <section id="tab-config" class="tab-content active">
                <h2>‚öôÔ∏è Configura√ß√£o da Rodada</h2>
                <p>Insira os nomes dos jogadores nas listas correspondentes para balancear os times.</p>
                
                <div class="gender-input-container">
                    <div class="gender-block">
                        <h3>üöπ Masculino</h3>
                        <textarea id="men-input" rows="10" placeholder="Lista de homens..."></textarea>
                    </div>
                    <div class="gender-block">
                        <h3>üö∫ Feminino</h3>
                        <textarea id="women-input" rows="10" placeholder="Lista de mulheres..."></textarea>
                    </div>
                </div>
                
                <button id="btn-sortear">üé≤ Sortear Times Balanceados</button>
            </section>

            <section id="tab-times" class="tab-content">
                <h2>üë• Times Sorteados</h2>
                <div id="teams-output"></div>
                
                <button id="btn-gerar-lista-times" class="btn-green">üìÑ Copiar Lista de Times</button>
                <textarea id="teams-list-output" class="copy-textarea" readonly></textarea>
                
                <div id="rotation-output"></div>
            </section>

            <section id="tab-partidas" class="tab-content">
                <h2>‚öîÔ∏è Controle de Partidas</h2>
                <div style="margin-bottom: 15px; padding: 10px; background: rgba(0,150,255,0.1); border-radius: 8px;">
                    <p><strong>Regra de Pausa:</strong> Times que jogarem <strong>2 vezes seguidas</strong> devem descansar na pr√≥xima.</p>
                </div>
                <ul id="match-list"></ul>
                
                <button id="btn-gerar-lista-partidas" class="btn-green">üìÑ Copiar Ordem dos Jogos</button>
                <textarea id="partidas-list-output" class="copy-textarea" readonly></textarea>
            </section>

            <section id="tab-placar" class="tab-content">
                <h2>üî¢ Placar ao Vivo</h2>
                <div id="placar-setup">
                    <select id="match-selector">
                        <option value="">-- Selecione a partida para iniciar --</option>
                    </select>
                    <button id="btn-iniciar-partida">‚ñ∂Ô∏è Iniciar Partida</button>
                </div>
                
                <div class="scoreboard">
                    <div class="score-team">
                        <h3 id="placar-time-a">Time A</h3>
                        <div class="score-display" id="score-a">0</div>
                        <button class="btn-score" data-team="a" disabled>+</button>
                    </div>
                    <div class="score-vs">VS</div>
                    <div class="score-team">
                        <h3 id="placar-time-b">Time B</h3>
                        <div class="score-display" id="score-b">0</div>
                        <button class="btn-score" data-team="b" disabled>+</button>
                    </div>
                </div>
                <button id="btn-reset-placar">üîÑ Resetar Placar</button>
                <button id="btn-finalizar-partida" disabled>‚úÖ Finalizar & Salvar (25pts)</button>
            </section>

            <section id="tab-resultados" class="tab-content">
                <h2>üìã Hist√≥rico de Resultados</h2>
                <textarea id="results-output" rows="12" readonly style="font-family: monospace;"></textarea>
                
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;">
                    <button id="btn-copiar-resultados" class="btn-green" style="flex: 1; margin-top:0;">üìÑ Copiar Tudo</button>
                    <button id="btn-baixar-resumo" style="flex: 1; margin-top:0;">üíæ Baixar PDF</button>
                    <button id="btn-limpar-resultados" class="btn-red" style="flex: 1; margin-top:0;">üóëÔ∏è Limpar Hist√≥rico</button>
                </div>
            </section>

        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Configura√ß√µes Globais ---
            const TEAM_SIZE = 6;
            const MIN_TOTAL_PLAYERS = 13;
            const STORAGE_KEY = 'volei_app_results_v1';

            const teamColors = [
                 { name: "Laranja", hex: "#FFAB91" }, { name: "Verde", hex: "#A5D6A7" },
                 { name: "Azul", hex: "#90CAF9" },    { name: "Rosa", hex: "#F48FB1" },
                 { name: "Roxo", hex: "#CE93D8" },    { name: "Amarelo", hex: "#FFF59D" },
                 { name: "Ciano", hex: "#80DEEA" },   { name: "Vermelho", hex: "#EF9A9A" }
            ];

            // --- Estado da Aplica√ß√£o ---
            let state = {
                times: [],    // { nome, jogadores: [{nome, genero}], tipo, colorName, colorHex }
                partidas: [], // [ [nomeTimeA, nomeTimeB], ... ]
                resultados: []
            };

            // --- Refer√™ncias de Elementos ---
            const els = {
                tabs: document.querySelectorAll('.tab-link'),
                contents: document.querySelectorAll('.tab-content'),
                menInput: document.getElementById('men-input'),
                womenInput: document.getElementById('women-input'),
                teamsOutput: document.getElementById('teams-output'),
                rotationOutput: document.getElementById('rotation-output'),
                matchList: document.getElementById('match-list'),
                matchSelector: document.getElementById('match-selector'),
                resultsOutput: document.getElementById('results-output'),
                scoreA: document.getElementById('score-a'),
                scoreB: document.getElementById('score-b'),
                nameA: document.getElementById('placar-time-a'),
                nameB: document.getElementById('placar-time-b'),
                btnsScore: document.querySelectorAll('.btn-score'),
                btnFinalizar: document.getElementById('btn-finalizar-partida'),
                teamsListCopy: document.getElementById('teams-list-output'),
                partidasListCopy: document.getElementById('partidas-list-output')
            };

            // =========================================
            // 1. NAVEGA√á√ÉO E UTILIT√ÅRIOS
            // =========================================
            function switchTab(tabId) {
                els.tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === tabId));
                els.contents.forEach(c => c.classList.toggle('active', c.id === tabId));
            }
            els.tabs.forEach(link => link.addEventListener('click', () => switchTab(link.dataset.tab)));

            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            async function copyToClipboard(text, fallbackElement) {
                if (navigator.clipboard && window.isSecureContext) {
                    try {
                        await navigator.clipboard.writeText(text);
                        alert('Copiado para a √°rea de transfer√™ncia!');
                        return;
                    } catch (e) { console.error(e); }
                }
                fallbackElement.style.display = 'block';
                fallbackElement.value = text;
                fallbackElement.select();
                alert('Seu navegador bloqueou a c√≥pia autom√°tica. Copie manualmente da caixa de texto que apareceu.');
            }

            // =========================================
            // 2. N√öCLEO: SORTEIO BALANCEADO
            // =========================================
            document.getElementById('btn-sortear').addEventListener('click', () => {
                // 1. Coleta e limpa nomes
                const getNames = (textarea) => textarea.value.split('\n').map(n => n.trim()).filter(n => n);
                let men = getNames(els.menInput);
                let women = getNames(els.womenInput);
                const totalPlayers = men.length + women.length;

                if (totalPlayers < MIN_TOTAL_PLAYERS) {
                    alert(`M√≠nimo de ${MIN_TOTAL_PLAYERS} jogadores necess√°rios. Atual: ${totalPlayers}.`);
                    return;
                }

                // 2. Prepara para o sorteio
                men = shuffle(men);
                women = shuffle(women);
                state.times = [];
                let teamCounter = 1;

                // 3. Calcula quantos times COMPLETOS (6 jogadores) podemos formar
                const numFullTeams = Math.floor(totalPlayers / TEAM_SIZE);
                
                // 4. Loop para criar os times COMPLETOS balanceados
                for (let i = 0; i < numFullTeams; i++) {
                    let teamPlayers = [];
                    
                    // Calcula quantos ainda est√£o dispon√≠veis
                    const menLeft = men.length;
                    const womenLeft = women.length;
                    const totalLeft = menLeft + womenLeft;

                    // Calcula a propor√ß√£o ideal para ESTE time baseado no que sobrou
                    // (Isso evita que o √∫ltimo time fique s√≥ com um g√™nero se o arredondamento falhar)
                    let numMenToTake = Math.round(TEAM_SIZE * (menLeft / totalLeft));
                    let numWomenToTake = TEAM_SIZE - numMenToTake;

                    // Ajustes de seguran√ßa se faltar gente de um g√™nero espec√≠fico
                    if (numMenToTake > menLeft) {
                        numMenToTake = menLeft;
                        numWomenToTake = TEAM_SIZE - numMenToTake;
                    } else if (numWomenToTake > womenLeft) {
                        numWomenToTake = womenLeft;
                        numMenToTake = TEAM_SIZE - numWomenToTake;
                    }

                    // Puxa os jogadores das listas principais
                    for (let m = 0; m < numMenToTake; m++) teamPlayers.push({ name: men.pop(), gender: 'M' });
                    for (let w = 0; w < numWomenToTake; w++) teamPlayers.push({ name: women.pop(), gender: 'F' });

                    // Registra o time
                    const color = teamColors[(teamCounter - 1) % teamColors.length];
                    state.times.push({
                        nome: `Time ${teamCounter++}`,
                        jogadores: shuffle(teamPlayers), // Embaralha a ordem interna do time
                        tipo: 'completo',
                        colorName: color.name,
                        colorHex: color.hex
                    });
                }

                // 5. Trata os SOBRESSALENTES (Revezamento ou Reserva)
                let leftovers = [];
                while (men.length) leftovers.push({ name: men.pop(), gender: 'M' });
                while (women.length) leftovers.push({ name: women.pop(), gender: 'F' });

                if (leftovers.length > 0) {
                    const color = teamColors[(teamCounter - 1) % teamColors.length];
                    // Regra: 3 a 5 = Revezamento, 1 a 2 = Reserva
                    const tipo = (leftovers.length >= 3) ? 'revezamento' : 'reserva';
                    state.times.push({
                        nome: `Time ${teamCounter++}`,
                        jogadores: shuffle(leftovers),
                        tipo: tipo,
                        colorName: color.name,
                        colorHex: color.hex
                    });
                }

                renderTeams();
                generateMatches();
                switchTab('tab-times');
            });

            // --- Renderiza√ß√£o dos Times na Tela ---
            function renderTeams() {
                els.teamsOutput.innerHTML = '';
                els.rotationOutput.innerHTML = '';
                let hasRotation = false, hasReserves = false;

                state.times.forEach(time => {
                    const card = document.createElement('div');
                    card.className = 'team-card';
                    card.style.setProperty('--team-color', time.colorHex);

                    let note = '';
                    if (time.tipo === 'completo') {
                         note = `<div class="team-card-note" style="background:${time.colorHex}33">Empresta jogadores na pausa.</div>`;
                    } else if (time.tipo === 'revezamento') {
                        hasRotation = true;
                        note = `<div class="team-card-note">Recebe ${TEAM_SIZE - time.jogadores.length} jogador(es) de quem pausa.</div>`;
                    } else {
                        hasReserves = true;
                        note = `<div class="team-card-note">Aguardam a pr√≥xima rodada.</div>`;
                    }

                    const listHtml = time.jogadores.map(p => `
                        <li>
                            <span>${p.name}</span>
                            <span class="gender-tag tag-${p.gender.toLowerCase()}">${p.gender}</span>
                        </li>
                    `).join('');

                    card.innerHTML = `
                        <h3>${time.nome} (${time.colorName}) <small>[${time.tipo}]</small></h3>
                        <ul>${listHtml}</ul>
                        ${note}
                    `;
                    els.teamsOutput.appendChild(card);
                });

                // Explica√ß√£o das regras no rodap√©
                if (hasRotation || hasReserves) {
                    els.rotationOutput.innerHTML = '<h3>Regras Ativas:</h3>';
                    if (hasRotation) els.rotationOutput.innerHTML += '<p>üîÑ <strong>Revezamento:</strong> O time incompleto joga pegando emprestado jogadores do time que estiver descansando na rodada.</p>';
                    if (hasReserves) els.rotationOutput.innerHTML += '<p>‚è≥ <strong>Reserva:</strong> Jogadores insuficientes para formar base de time. Aguardam nova forma√ß√£o.</p>';
                }
            }

            // =========================================
            // 3. GERENCIAMENTO DE PARTIDAS
            // =========================================
            function generateMatches() {
                state.partidas = [];
                els.matchList.innerHTML = '';
                els.matchSelector.innerHTML = '<option value="">-- Selecione para jogar --</option>';

                const activeTeams = state.times.filter(t => t.tipo !== 'reserva');
                if (activeTeams.length < 2) {
                    els.matchList.innerHTML = '<li>Times insuficientes para gerar partidas.</li>';
                    return;
                }

                // Round Robin (Todos contra todos)
                for (let i = 0; i < activeTeams.length; i++) {
                    for (let j = i + 1; j < activeTeams.length; j++) {
                        const tA = activeTeams[i];
                        const tB = activeTeams[j];
                        state.partidas.push([tA.nome, tB.nome]);

                        const label = `${tA.nome} (${tA.colorName}) vs ${tB.nome} (${tB.colorName})`;
                        
                        // Lista visual
                        const li = document.createElement('li');
                        li.textContent = label;
                        els.matchList.appendChild(li);

                        // Seletor do placar
                        const opt = document.createElement('option');
                        opt.value = `${tA.nome}|${tB.nome}`;
                        opt.textContent = label;
                        els.matchSelector.appendChild(opt);
                    }
                }
            }

            // =========================================
            // 4. PLACAR E RESULTADOS
            // =========================================
            let currentScore = { a: 0, b: 0 };

            document.getElementById('btn-iniciar-partida').addEventListener('click', () => {
                const val = els.matchSelector.value;
                if (!val) return alert('Selecione uma partida!');
                
                const [nA, nB] = val.split('|');
                const tA = state.times.find(t => t.nome === nA);
                const tB = state.times.find(t => t.nome === nB);

                els.nameA.textContent = `${tA.nome} (${tA.colorName})`;
                els.nameA.style.color = tA.colorHex;
                els.nameB.textContent = `${tB.nome} (${tB.colorName})`;
                els.nameB.style.color = tB.colorHex;

                resetScore(true); // Habilita bot√µes
            });

            els.btnsScore.forEach(btn => btn.addEventListener('click', (e) => {
                const side = e.target.dataset.team;
                if (side === 'a') els.scoreA.textContent = ++currentScore.a;
                else els.scoreB.textContent = ++currentScore.b;

                if (currentScore.a >= 25 || currentScore.b >= 25) {
                    alert('Fim de jogo! Clique em "Finalizar & Salvar".');
                    toggleScoreBtns(false);
                }
            }));

            els.btnFinalizar.addEventListener('click', () => {
                if (currentScore.a === 0 && currentScore.b === 0) return alert('Placar zerado.');
                
                const res = `Partida: ${els.nameA.textContent} vs ${els.nameB.textContent} | Placar: ${currentScore.a} - ${currentScore.b}`;
                state.resultados.push(res);
                saveResults();
                
                // Remove do seletor
                const activeOpt = els.matchSelector.querySelector(`option[value="${els.matchSelector.value}"]`);
                if (activeOpt) activeOpt.remove();

                alert('Resultado salvo com sucesso!');
                resetScore(false); // Reseta e desabilita
                els.nameA.textContent = 'Time A'; els.nameA.style.color = '#fff';
                els.nameB.textContent = 'Time B'; els.nameB.style.color = '#fff';
                els.matchSelector.value = "";
            });

            document.getElementById('btn-reset-placar').addEventListener('click', () => resetScore(els.nameA.textContent !== 'Time A'));

            function resetScore(enable) {
                currentScore = { a: 0, b: 0 };
                els.scoreA.textContent = 0;
                els.scoreB.textContent = 0;
                toggleScoreBtns(enable);
            }

            function toggleScoreBtns(enable) {
                els.btnsScore.forEach(b => b.disabled = !enable);
                els.btnFinalizar.disabled = !enable;
            }

            // =========================================
            // 5. PERSIST√äNCIA E EXPORTA√á√ÉO
            // =========================================
            function loadResults() {
                const data = localStorage.getItem(STORAGE_KEY);
                if (data) {
                    state.resultados = JSON.parse(data);
                    updateResultsView();
                }
            }
            function saveResults() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state.resultados));
                updateResultsView();
            }
            function updateResultsView() {
                els.resultsOutput.value = state.resultados.join('\n') || 'Nenhum resultado salvo ainda.';
            }
            loadResults();

            document.getElementById('btn-limpar-resultados').addEventListener('click', () => {
                if (confirm('Apagar TODO o hist√≥rico de resultados?')) {
                    state.resultados = [];
                    localStorage.removeItem(STORAGE_KEY);
                    updateResultsView();
                }
            });

            // --- Copiar Listas ---
            document.getElementById('btn-gerar-lista-times').addEventListener('click', () => {
                if (!state.times.length) return alert('Sorteie os times primeiro.');
                let text = state.times.map(t => 
                    `--- ${t.nome} (${t.colorName}) ---\n` + 
                    t.jogadores.map(p => `${p.name} (${p.gender})`).join('\n')
                ).join('\n\n');
                copyToClipboard(text, els.teamsListCopy);
            });

            document.getElementById('btn-gerar-lista-partidas').addEventListener('click', () => {
                if (!state.partidas.length) return alert('Sem partidas geradas.');
                let text = "--- ORDEM DOS JOGOS ---\n\n";
                state.partidas.forEach((p, i) => {
                   const tA = state.times.find(t => t.nome === p[0]);
                   const tB = state.times.find(t => t.nome === p[1]);
                   text += `${i+1}¬∫ Jogo: ${tA.nome} (${tA.colorName}) x ${tB.nome} (${tB.colorName})\n`;
                });
                copyToClipboard(text, els.partidasListCopy);
            });

            document.getElementById('btn-copiar-resultados').addEventListener('click', () => {
                copyToClipboard(els.resultsOutput.value, els.resultsOutput);
            });

            // --- Baixar PDF ---
            document.getElementById('btn-baixar-resumo').addEventListener('click', () => {
                if (!window.jspdf) return alert('Erro ao carregar biblioteca PDF. Recarregue a p√°gina.');
                if (!state.times.length && !state.resultados.length) return alert('Nada para salvar ainda.');

                const doc = new window.jspdf.jsPDF();
                let y = 20; const margin = 15;
                const checkPage = (h=10) => { if (y+h > 280) { doc.addPage(); y=20; }};

                doc.setFontSize(18); doc.text('Resumo do V√¥lei', margin, y); y+=10;
                doc.setFontSize(10); doc.setTextColor(100);
                doc.text(`Gerado em: ${new Date().toLocaleString()}`, margin, y); y+=15;
                doc.setTextColor(0);

                // Times
                doc.setFontSize(14); doc.text('Times Sorteados', margin, y); y+=8;
                doc.setFontSize(11);
                state.times.forEach(t => {
                    checkPage(25);
                    doc.setTextColor(t.colorHex);
                    doc.text(`‚Ä¢ ${t.nome} (${t.colorName}) [${t.tipo.toUpperCase()}]`, margin, y);
                    y+=6;
                    doc.setTextColor(60);
                    // Lista os jogadores com (M)/(F)
                    const playersList = t.jogadores.map(p => `${p.name} (${p.gender})`).join(', ');
                    const lines = doc.splitTextToSize(playersList, 180);
                    doc.text(lines, margin+5, y);
                    y += (lines.length * 6) + 4;
                });

                // Resultados
                checkPage(30); y+=5;
                doc.setTextColor(0); doc.setFontSize(14);
                doc.text('Resultados Salvos', margin, y); y+=8;
                doc.setFontSize(10);
                if (state.resultados.length) {
                    state.resultados.forEach(r => {
                        checkPage(8);
                        doc.text(r, margin, y); y+=6;
                    });
                } else {
                    doc.setTextColor(150); doc.text('(Nenhum resultado registrado)', margin, y);
                }

                doc.save(`Volei_${new Date().toISOString().slice(0,10)}.pdf`);
            });

        });
    </script>
</body>
</html>
